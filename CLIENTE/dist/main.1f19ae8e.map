{"version":3,"sources":["pintarHTML.js","node_modules/node-fetch/browser.js","conexionAPI.js","main.js"],"names":["fs","require","pintarLogin","text","pintarPlantilla","getGlobal","self","window","global","Error","module","exports","fetch","default","bind","Headers","Request","Response","urlAPI","getProductos","callback","then","response","json","data","getProductosCategoria","idcategoria","getCategorias","login","usuario","pass","us","nick","password","headers","method","body","JSON","stringify","status","console","log","err","decodeUsuario","token","coded","split","decoded","atob","parse","pintarProductos","datos","htmlString","i","length","producto","t","id","nombre","tablaProductos","innerHTML","categoriaPintando","cat","plantillaPintando","document","getElementById","localStorage","getItem","addEventListener","removeItem","loginPintando","divCategorias","categoria","j","ca","boton","usu","value","insertAdjacentHTML","setItem"],"mappings":"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","file":"main.1f19ae8e.map","sourceRoot":"..","sourcesContent":["var fs = require(\"fs\");\n\nfunction pintarLogin(){\n    var text = fs.readFileSync('htmls/login.html', 'utf8');\n    return text;\n}\n\nexport {pintarLogin};\n\nfunction pintarPlantilla(){\n    var text = fs.readFileSync('htmls/plantilla.html', 'utf8');\n    return text;\n}\n\nexport {pintarPlantilla};","\"use strict\";\n\n// ref: https://github.com/tc39/proposal-global\nvar getGlobal = function () {\n\t// the only reliable means to get the global object is\n\t// `Function('return this')()`\n\t// However, this causes CSP violations in Chrome apps.\n\tif (typeof self !== 'undefined') { return self; }\n\tif (typeof window !== 'undefined') { return window; }\n\tif (typeof global !== 'undefined') { return global; }\n\tthrow new Error('unable to locate global object');\n}\n\nvar global = getGlobal();\n\nmodule.exports = exports = global.fetch;\n\n// Needed for TypeScript and Webpack.\nexports.default = global.fetch.bind(global);\n\nexports.Headers = global.Headers;\nexports.Request = global.Request;\nexports.Response = global.Response;","const fetch = require(\"node-fetch\")\n\nconst urlAPI = 'http://localhost:3000';\n\nfunction getProductos(callback){\n    fetch(urlAPI + '/productos').then(function(response){\n        response.json().then(function(data){\n            //console.log(data);\n            return callback(data);\n        })\n    })\n}\n\nexport {getProductos}\n\nfunction getProductosCategoria(idcategoria, callback){\n    fetch(urlAPI + '/categorias/'+idcategoria+'/productos').then(function(response){\n        response.json().then(function(data){\n            //console.log(data);\n            return callback(data);\n        })\n    })\n}\n\nexport {getProductosCategoria}\n\nfunction getCategorias(callback){\n    fetch(urlAPI + '/categorias').then(function(response){\n        response.json().then(function(data){\n            //console.log(data);\n            return callback(data);\n        })\n    })\n}\n\nexport {getCategorias}\n\nfunction login(usuario, pass, callback){\n    var us = {nick: usuario, password: pass};\n    //console.log(us.nick+ \" \"+ us.password)\n    fetch(urlAPI + '/login', {\n        headers: {\n            'Accept': 'application/json',\n            'Content-Type': 'application/json'\n          },\n        method: 'POST',\n        body: JSON.stringify(us)\n    }).then(function(response){\n        if(response.status == 400 || response.status == 401){\n            console.log(response)\n            return callback({err: 'No login',text: 'Error, revisa los datos y vuelvelo a intentar'});\n        }\n        else{\n            response.text().then(function(data){\n                return callback(data);\n            })\n        }\n    })\n}\n\nexport {login}","import {pintarLogin, pintarPlantilla} from './pintarHTML.js'\nimport {getProductos, getProductosCategoria, getCategorias, login} from './conexionAPI.js'\n\nfunction decodeUsuario(token){\n    var coded = token.split('.')[1]\n    var decoded = atob(coded);\n    var json = JSON.parse(decoded);\n    return json;\n}\n\nfunction pintarProductos(datos){\n    var htmlString = \"\";\n        var i;\n        for(i=0;i<datos.length;i++){\n            var producto = datos[i];\n            var t = '<tr><th>'+producto.id+'</th><th>'+producto.nombre+'</th><th><button type=\"button\" style=\"margin-right: 15px\" class=\"btn btn-light id=\"ver'+producto.id+'\">Ver</button><button type=\"button\" class=\"btn btn-danger id=\"borrar'+producto.id+'\">Borrar</button></th></tr>';\n            htmlString+=t;\n        }\n        tablaProductos.innerHTML = htmlString;\n}\n\nfunction categoriaPintando(cat){\n    getProductosCategoria(cat.id, function(datos){\n        pintarProductos(datos);\n    })\n}\n\nfunction plantillaPintando(){\n    document.getElementById('principal').innerHTML = pintarPlantilla();\n    document.getElementById('nomUsuario').innerHTML = localStorage.getItem('user');\n    document.getElementById('linkLogout').addEventListener('click', ()=>{\n        localStorage.removeItem('token');\n        localStorage.removeItem('user');\n        loginPintando();\n    });\n\n    //Aquí meto los productos\n    var tablaProductos = document.getElementById('tablaProductos');\n    getProductos(function(datos){\n        pintarProductos(datos);\n    })\n\n    //Aquí meto las categorias\n    var divCategorias = document.getElementById('divCategorias');\n    getCategorias(function(datos){\n        var htmlString = \"\";\n        var i;\n        for(i=0;i<datos.length;i++){\n            var categoria = datos[i];\n            var t = '<li class=\"nav-item\"><a id=\"categoria'+i+'\"class=\"nav-link\" href=\"#\"><i class=\"fas fa-fw\"></i><span>'+ categoria.nombre +'</span></a></li>'\n            htmlString+=t;\n        }\n        divCategorias.innerHTML = htmlString;\n        var j\n        for(j=0;j<datos.length;j++){\n            (function(){\n                var ca = datos[j];\n                var boton = document.getElementById('categoria'+j);\n                boton.addEventListener('click', function(){\n                    categoriaPintando(ca)\n                }); \n            }())\n            \n        }\n    });\n}\n\nfunction loginPintando(){\n    document.getElementById('principal').innerHTML = pintarLogin();\n\n    document.getElementById('botonLogin').addEventListener('click', ()=>{\n    var usu = document.getElementById('inputUsuario').value;\n    var pass = document.getElementById('inputPassword').value;\n    var text = login(usu, pass, function(datos){\n        if(datos.err){\n            document.getElementById('loginDiv').insertAdjacentHTML('afterend', '<div class=\"alert alert-danger alert-dismissible fade show\" role=\"alert\">' + datos.text + '<button type=\"button\" class=\"close\" data-dismiss=\"alert\" aria-label=\"Close\"><span aria-hidden=\"true\">&times;</span></button></div>')\n        }\n        else{\n            //console.log(datos);\n            localStorage.setItem('token', datos);\n            localStorage.setItem('user', decodeUsuario(datos).login);\n            //guardarlo en localstorage y acceder\n            plantillaPintando();\n            }\n        });\n    });\n}\n\nloginPintando();"]}